background_knowledge = """中华人民共和国水土保持法.docx
水土保持规划一经批准，应当严格执行；经批准的规划根据实际情况需要修改的，应当按照规划编制程序报原批准机关批准。
第十五条　有关基础设施建设、矿产资源开发、城镇建设、公共服务设施建设等方面的规划，在实施过程中可能造成水土流失的，规划的组织编制机关应当在规划中提出水土流失预防和治理的对策和措施，并在规划报请审批前征求本级人民政府水行政主管部门的意见。
第三章 预防
第十六条　地方各级人民政府应当按照水土保持规划，采取封育保护、自然修复等措施，组织单位和个人植树种草，扩大林草覆盖面积，涵养水源，预防和减轻水土流失。
第十七条　地方各级人民政府应当加强对取土、挖砂、采石等活动的管理，预防和减轻水土流失。
禁止在崩塌、滑坡危险区和泥石流易发区从事取土、挖砂、采石等可能造成水土流失的活动。崩塌、滑坡危险区和泥石流易发区的范围，由县级以上地方人民政府划定并公告。崩塌、滑坡危险区和泥石流易发区的划定，应当与地质灾害防治规划确定的地质灾害易发区、重点防治区相衔接。
第十八条　水土流失严重、生态脆弱的地区，应当限制或者禁止可能造成水土流失的生产建设活动，严格保护植物、沙壳、结皮、地衣等。在侵蚀沟的沟坡和沟岸、河流的两岸以及湖泊和水库的周边，土地所有权人、使用权人或者有关管理单位应当营造植物保护带。禁止开垦、开发植物保护带。
第十九条　水土保持设施的所有权人或者使用权人应当加强对水土保持设施的管理与维护，落实管护责任，保障其功能正常发挥。
第二十条　禁止在二十五度以上陡坡地开垦种植农作物。在二十五度以上陡坡地种植经济林的，应当科学选择树种，合理确定规模，采取水土保持措施，防止造成水土流失。
省、自治区、直辖市根据本行政区域的实际情况，可以规定小于二十五度的禁止开垦坡度。禁止开垦的陡坡地的范围由当地县级人民政府划定并公告。
第二十一条　禁止毁林、毁草开垦和采集发菜。禁止在水土流失重点预防区和重点治理区铲草皮、挖树兜或者滥挖虫草、甘草、麻黄等。
第二十二条　林木采伐应当采用合理方式，严格控制皆伐；对水源涵养林、水土保持林、防风固沙林等防护林只能进行抚育和更新性质的采伐；对采伐区和集材道应当采取防止水土流失的措施，并在采伐后及时更新造林。
在林区采伐林木的，采伐方案中应当有水土保持措施。采伐方案经林业主管部门批准后，由林业主管部门和水行政主管部门监督实施。第二十三条　在五度以上坡地植树造林、抚育幼林、种植中药材等，应当采取水土保持措施。
在禁止开垦坡度以下、五度以上的荒坡地开垦种植农作物，应当采取水土保持措施。具体办法由省、自治区、直辖市根据本行政区域的实际情况规定。
第二十四条　生产建设项目选址、选线应当避让水土流失重点预防区和重点治理区；无法避让的，应当提高防治标准，优化施工工艺，减少地表扰动和植被损坏范围，有效控制可能造成的水土流失。
第二十五条　在山区、丘陵区、风沙区以及水土保持规划确定的容易发生水土流失的其他区域开办可能造成水土流失的生产建设项目，生产建设单位应当编制水土保持方案，报县级以上人民政府水行政主管部门审批，并按照经批准的水土保持方案，采取水土流失预防和治理措施。没有能力编制水土保持方案的，应当委托具备相应技术条件的机构编制。
水土保持方案应当包括水土流失预防和治理的范围、目标、措施和投资等内容。
水土保持方案经批准后，生产建设项目的地点、规模发生重大变化的，应当补充或者修改水土保持方案并报原审批机关批准。

中华人民共和国水土保持法.docx
生产建设项目在建设过程中和生产过程中发生的水土保持费用，按照国家统一的财务会计制度处理。
第三十三条　国家鼓励单位和个人按照水土保持规划参与水土流失治理，并在资金、技术、税收等方面予以扶持。
第三十四条　国家鼓励和支持承包治理荒山、荒沟、荒丘、荒滩，防治水土流失，保护和改善生态环境，促进土地资源的合理开发和可持续利用，并依法保护土地承包合同当事人的合法权益。
承包治理荒山、荒沟、荒丘、荒滩和承包水土流失严重地区农村土地的，在依法签订的土地承包合同中应当包括预防和治理水土流失责任的内容。
第三十五条　在水力侵蚀地区，地方各级人民政府及其有关部门应当组织单位和个人，以天然沟壑及其两侧山坡地形成的小流域为单元，因地制宜地采取工程措施、植物措施和保护性耕作等措施，进行坡耕地和沟道水土流失综合治理。
在风力侵蚀地区，地方各级人民政府及其有关部门应当组织单位和个人，因地制宜地采取轮封轮牧、植树种草、设置人工沙障和网格林带等措施，建立防风固沙防护体系。在重力侵蚀地区，地方各级人民政府及其有关部门应当组织单位和个人，采取监测、径流排导、削坡减载、支挡固坡、修建拦挡工程等措施，建立监测、预报、预警体系。
第三十六条　在饮用水水源保护区，地方各级人民政府及其有关部门应当组织单位和个人，采取预防保护、自然修复和综合治理措施，配套建设植物过滤带，积极推广沼气，开展清洁小流域建设，严格控制化肥和农药的使用，减少水土流失引起的面源污染，保护饮用水水源。
第三十七条　已在禁止开垦的陡坡地上开垦种植农作物的，应当按照国家有关规定退耕，植树种草；耕地短缺、退耕确有困难的，应当修建梯田或者采取其他水土保持措施。
在禁止开垦坡度以下的坡耕地上开垦种植农作物的，应当根据不同情况，采取修建梯田、坡面水系整治、蓄水保土耕作或者退耕等措施。
第三十八条　对生产建设活动所占用土地的地表土应当进行分层剥离、保存和利用，做到土石方挖填平衡，减少地表扰动范围；对废弃的砂、石、土、矸石、尾矿、废渣等存放地，应当采取拦挡、坡面防护、防洪排导等措施。生产建设活动结束后，应当及时在取土场、开挖面和存放地的裸露土地上植树种草、恢复植被，对闭库的尾矿库进行复垦。在干旱缺水地区从事生产建设活动，应当采取防止风力侵蚀措施，设置降水蓄渗设施，充分利用降水资源。
第三十九条　国家鼓励和支持在山区、丘陵区、风沙区以及容易发生水土流失的其他区域，采取下列有利于水土保持的措施：
（一）免耕、等高耕作、轮耕轮作、草田轮作、间作套种等；
（二）封禁抚育、轮封轮牧、舍饲圈养；
（三）发展沼气、节柴灶，利用太阳能、风能和水能，以煤、电、气代替薪柴等；
（四）从生态脆弱地区向外移民；
（五）其他有利于水土保持的措施。
第五章 监测和监督
第四十条　县级以上人民政府水行政主管部门应当加强水土保持监测工作，发挥水土保持监测工作在政府决策、经济社会发展和社会公众服务中的作用。县级以上人民政府应当保障水土保持监测工作经费。
国务院水行政主管部门应当完善全国水土保持监测网络，对全国水土流失进行动态监测。
第四十一条　对可能造成严重水土流失的大中型生产建设项目，生产建设单位应当自行或者委托具备水土保持监测资质的机构，对生产建设活动造成的水土流失进行监测，并将监测情况定期上报当地水行政主管部门。
从事水土保持监测活动应当遵守国家有关技术标准、规范和规程，保证监测质量。

中华人民共和国水土保持法.docx
在侵蚀沟的沟坡和沟岸、河流的两岸以及湖泊和水库的周边，土地所有权人、使用权人或者有关管理单位应当营造植物保护带。禁止开垦、开发植物保护带。
第十九条　水土保持设施的所有权人或者使用权人应当加强对水土保持设施的管理与维护，落实管护责任，保障其功能正常发挥。
第二十条　禁止在二十五度以上陡坡地开垦种植农作物。在二十五度以上陡坡地种植经济林的，应当科学选择树种，合理确定规模，采取水土保持措施，防止造成水土流失。
省、自治区、直辖市根据本行政区域的实际情况，可以规定小于二十五度的禁止开垦坡度。禁止开垦的陡坡地的范围由当地县级人民政府划定并公告。
第二十一条　禁止毁林、毁草开垦和采集发菜。禁止在水土流失重点预防区和重点治理区铲草皮、挖树兜或者滥挖虫草、甘草、麻黄等。
第二十二条　林木采伐应当采用合理方式，严格控制皆伐；对水源涵养林、水土保持林、防风固沙林等防护林只能进行抚育和更新性质的采伐；对采伐区和集材道应当采取防止水土流失的措施，并在采伐后及时更新造林。
在林区采伐林木的，采伐方案中应当有水土保持措施。采伐方案经林业主管部门批准后，由林业主管部门和水行政主管部门监督实施。采伐方案经林业主管部门批准后，由林业主管部门和水行政主管部门监督实施。
第二十三条　在五度以上坡地植树造林、抚育幼林、种植中药材等，应当采取水土保持措施。
在禁止开垦坡度以下、五度以上的荒坡地开垦种植农作物，应当采取水土保持措施。具体办法由省、自治区、直辖市根据本行政区域的实际情况规定。
第二十四条　生产建设项目选址、选线应当避让水土流失重点预防区和重点治理区；无法避让的，应当提高防治标准，优化施工工艺，减少地表扰动和植被损坏范围，有效控制可能造成的水土流失。
第二十五条　在山区、丘陵区、风沙区以及水土保持规划确定的容易发生水土流失的其他区域开办可能造成水土流失的生产建设项目，生产建设单位应当编制水土保持方案，报县级以上人民政府水行政主管部门审批，并按照经批准的水土保持方案，采取水土流失预防和治理措施。没有能力编制水土保持方案的，应当委托具备相应技术条件的机构编制。
水土保持方案应当包括水土流失预防和治理的范围、目标、措施和投资等内容。
水土保持方案经批准后，生产建设项目的地点、规模发生重大变化的，应当补充或者修改水土保持方案并报原审批机关批准。水土保持方案实施过程中，水土保持措施需要作出重大变更的，应当经原审批机关批准。
生产建设项目水土保持方案的编制和审批办法，由国务院水行政主管部门制定。
第二十六条　依法应当编制水土保持方案的生产建设项目，生产建设单位未编制水土保持方案或者水土保持方案未经水行政主管部门批准的，生产建设项目不得开工建设。
第二十七条　依法应当编制水土保持方案的生产建设项目中的水土保持设施，应当与主体工程同时设计、同时施工、同时投产使用；生产建设项目竣工验收，应当验收水土保持设施；水土保持设施未经验收或者验收不合格的，生产建设项目不得投产使用。
第二十八条　依法应当编制水土保持方案的生产建设项目，其生产建设活动中排弃的砂、石、土、矸石、尾矿、废渣等应当综合利用；不能综合利用，确需废弃的，应当堆放在水土保持方案确定的专门存放地，并采取措施保证不产生新的危害。
第二十九条　县级以上人民政府水行政主管部门、流域管理机构，应当对生产建设项目水土保持方案的实施情况进行跟踪检查，发现问题及时处理。
"""

answer = """在水土流失严重地区，开垦种植农作物受到以下限制：\n\n1. **限制或禁止生产建设活动**：水土流失严重、生态脆弱的地区，应当限制或者禁止可能造成水土流失的生产建设活动。\n2. **保护植物措施**：严格保护植物、沙壳、结皮、地衣等，禁止开垦、开发植物保护带。\n3. **坡度限制**：禁止在二十五度以上陡坡地开垦种植农作物。省、自治区、直辖市可根据实际情况规定更小的禁止开垦坡度。\n4. **水土保持措施**：在禁止开垦坡度以下、五度以上的荒坡地开垦种植农作物，应当采取水土保持措施，具体办法由地方政府规定。\n\n这些限制旨在预防和减轻水土流失，保护和改善生态环境。
"""

import nltk
from nltk.corpus import stopwords
from nltk.tokenize import word_tokenize
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import cosine_similarity
import numpy as np

# bks = 
bks = [item for bk in background_knowledge.split('\n\n') if bk.strip() for item in bk.split('\n') if item.strip()]

from app.schemas.llm import ModelType
from app.core.cache import model_manager
from app.runtime.reranker import Reranker

reranker: Reranker = model_manager.load_models(
    model='BAAI/bge-reranker-base', 
    device='cuda', 
    model_type=ModelType.RERANKER
)

sentence_pairs = [(answer, kb) for kb in bks]

all_scores = reranker.reranker.compute_score(sentence_pairs, normalize=True)

# 使用sorted()函数对数组进行排序，并返回一个排序后的数组和对应的索引
sorted_scores, sorted_indices = zip(*sorted(zip(all_scores, range(len(all_scores))), reverse=True))

print(bks[sorted_indices[0]])

